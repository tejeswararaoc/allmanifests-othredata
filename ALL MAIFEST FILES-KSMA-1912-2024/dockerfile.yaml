# Start with a base image containing Java runtime (Java 17)
FROM openjdk:17-jdk-alpine
ARG JAR_FILE=target/*.jar
ARG IAGRI_DB_URL
ARG IAGRI_DB_USERNAME
ARG IAGRI_DB_PASSWORD
ARG AZURE_FILE_SERVICE_HOST
ARG DPF_URL
ARG PYTHON_DPF_URL
ARG EXOTEL_URL
ARG AREA_UNIT_SCHEDULER_RATE
ARG NEW_RELIC_APP_NAME
ARG NEW_RELIC_LICENSE_KEY
ARG CMS_CLIENT_ID
ARG CMS_TOKEN_CLIENT_SECRET
ARG CMS_TOKEN_SCOPE
ARG CMS_TOKEN_GRANT_TYPE
ARG MICROSOFT_TOKEN_URL
ARG CMS_TOKEN_URL
ARG CMS_CLAIM_SEARCH_API

ENV AREA_UNIT_SCHEDULER_RATE=${AREA_UNIT_SCHEDULER_RATE}
ENV IAGRI_DB_URL=${IAGRI_DB_URL}
ENV IAGRI_DB_USERNAME=${IAGRI_DB_USERNAME}
ENV IAGRI_DB_PASSWORD=${IAGRI_DB_PASSWORD}
ENV AZURE_FILE_SERVICE_HOST=${AZURE_FILE_SERVICE_HOST}
ENV DPF_URL=${DPF_URL}
ENV PYTHON_DPF_URL=${PYTHON_DPF_URL}
ENV EXOTEL_URL=${EXOTEL_URL}
ENV CMS_CLAIM_SEARCH_API=${CMS_CLAIM_SEARCH_API}
ENV CMS_TOKEN_URL=${CMS_TOKEN_URL}
ENV MICROSOFT_TOKEN_URL=${MICROSOFT_TOKEN_URL}
ENV CMS_TOKEN_GRANT_TYPE=${CMS_TOKEN_GRANT_TYPE}
ENV CMS_TOKEN_SCOPE=${CMS_TOKEN_SCOPE}
ENV CMS_TOKEN_CLIENT_SECRET=${CMS_TOKEN_CLIENT_SECRET}
ENV CMS_CLIENT_ID=${CMS_CLIENT_ID}


COPY ./newrelic/newrelic.jar /app/newrelic.jar

ENV NEW_RELIC_LICENSE_KEY=${NEW_RELIC_LICENSE_KEY} 
ENV NEW_RELIC_APP_NAME=${NEW_RELIC_APP_NAME}   
WORKDIR /app
ADD ${JAR_FILE} app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-javaagent:newrelic.jar", "-jar", "app.jar"]
